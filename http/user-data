#cloud-config
autoinstall:
    version: 1
    early-commands:
        # workaround to stop ssh for packer as it thinks it timed out
        - sudo systemctl stop ssh
    locale: en_US
    keyboard:
        layout: us
        variant: ""
    packages: [open-vm-tools, openssh-server, cloud-init]
    network:
        ethernets:
          ens192:
            addresses: [192.168.1.30/24]
            nameservers:
                addresses: [192.168.1.3,8.8.8.8]
            routes:
            - to: default
              via: 192.168.1.2
        version: 2
    identity:
        hostname: ubuntu-server
        username: ubuntu
        password: "$6$rounds=4096$L4DACCuCJPFoQ/9I$64ipq92Y1Axnpssy4cMhb6BY1aKsAFHzwnKN/VdxpUZXhqidYkYwd.KygdXsrX8GZN6lBAGJFCbPrK3v4aUzN/"
    ssh:
        install-server: true
        allow-pw: true
    storage:
        layout:
            name: direct
    user-data:
        disable_root: false
    late-commands:
        - echo 'ubuntu ALL=(ALL) NOPASSWD:ALL' > /target/etc/sudoers.d/ubuntu
        - curtin in-target --target=/target -- chmod 440 /etc/sudoers.d/ubuntu
